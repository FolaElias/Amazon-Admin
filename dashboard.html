<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>360 Organic Foodie - Super-Admin Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="./style.css">

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
   <!-- Desktop Navbar (visible on md and up) -->
      <nav class="navbar navbar-expand-md bg-white d-none d-md-flex fixed-top">
        <div class="container-fluid">
          <img src="./images/Foodies logo without Banner 1.png" style="width: 50px; height: 50px" alt="">
          <span class="Navlogo1 d-md-none">360 Organic Foodie</span>
          <div class="collapse navbar-collapse">
            <ul class="navbar-nav me-auto">
              <li class="nav-item">
                <div class="input-group Navborder">
                  <button class="btn btn-outline-secondary border-0" type="button">
                    <i class="fas fa-search"></i>
                  </button>
                  <input type="text" class="form-control border-0" placeholder="Search here...">
                </div>
              </li>
            </ul>
            <form class="d-flex">
              <div class="d-flex align-items-center">
                <button class="text-reset me-3 btnSharp"><i class="fa-solid fa-cart-shopping"></i></button>
                <button class="text-reset me-4 btnSharp position-relative" onclick="toggleNotification(event)">
                  <i class="fas fa-bell"></i>
                  <span id="notificationBadge"
                        class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                        style="font-size: 0.7rem; display:none;">
                  </span>
                </button>
                <img id="userAvatar" class="me-3 rounded-circle" src="./images/cheerful-curly-man-with-bristle-points-left-wears-casual-clothes-spectacles 1.png" alt="User Avatar" width="40" height="40">
                <span id="userName" class="CustomP-14-400 me-3 text-dark fw-semibold"></span>
              </div>
            </form>
            <!-- notification pop-up  -->
              <div class="col-md-4" id="notificationPopUp">
                  <div class="card p-3" style=" overflow-y: auto;">
                    <h6 class="fw-bold mb-3">See all orders here</h6>
                    <ul class="list-unstyled" id="activityFeed"></ul>
                  </div>
              </div>
          </div>
        </div>
      </nav>
      <!-- Mobile Navbar (visible only on sm) -->
      <nav class="navbar bg-white px-3 d-flex justify-content-between align-items-center d-flex d-sm-flex d-md-none">
        <!-- Left side -->
        <div class="d-flex align-items-center">
          <!-- Hamburger -->
          <button class="btn p-0 me-3" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu">
            <i class="fa-solid fa-bars fs-4"></i>
          </button>
          <!-- Search -->
           <div class="search-container">
            <button class="btn p-0" id="mobileSearchBtn" aria-label="Open search">
              <i class="fa-solid fa-magnifying-glass fs-5 text-muted"></i>
            </button>
            <input
              type="text"
              id="mobileSearchInput"
              class="mobile-search-input"
              placeholder="Search dashboard..."
              aria-label="Search dashboard"
            />
          </div>
          <!-- <div class="search-container position-relative">
            <button class="btn p-0" id="mobileSearchBtn">
              <i class="fa-solid fa-magnifying-glass fs-5 text-muted"></i>
            </button>
            <input type="text" id="mobileSearchInput" class="form-control form-control-sm position-absolute"
              placeholder="Search..."
              style="width: 0; opacity: 0; transition: all 0.3s ease; left: 40px; top: 0; z-index: 1000;">
          </div> -->
        </div>
        <!-- Right side -->
        <div class="d-flex align-items-center">
          <!-- Bell -->
          <button class="text-reset me-1 btnSharp position-relative" onclick="toggleNotification(event)">
                  <i class="fas fa-bell"></i>
                  <span id="notificationBadge1"
                        class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                        style="font-size: 0.7rem; display:none;">
                  </span>
                </button>
          <!-- Profile -->
          <img src="./images/cheerful-curly-man-with-bristle-points-left-wears-casual-clothes-spectacles 1.png"
              class="rounded-circle"
              alt="Profile" width="40" height="40">
        </div>
              <div class="col-md-4" id="notificationPopUp1">
                  <div class="card p-3" style=" overflow-y: auto;">
                    <h6 class="fw-bold mb-3">Recent Activities in Your City</h6>
                    <ul class="list-unstyled" id="activityFeed1"></ul>
                  </div>
              </div>
      </nav>



      <!-- Sidebar (offcanvas for mobile) -->
      <div class="offcanvas offcanvas-start sidebar" tabindex="-1" id="sidebarMenu">
        <div class="offcanvas-header">
          <h5 class="offcanvas-title">Menu</h5>
          <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body p-3">
          <ul class="listItem">
            <li><a href="dashboard.html" class="active" style="text-decoration: none; color: #8D98AF; "><i class="fa-solid fa-house me-3"></i>Dashboard</a></li>
            <li><a href="orders.html" style="text-decoration: none; color: #8D98AF; "><i class="fa-solid fa-cart-shopping me-3"></i>Orders</a></li>
            <li><a href="product.html" style="text-decoration: none; color: #8D98AF; "><i class="fa-solid fa-user me-3"></i>Products</a></li>
            <li><a href="categories.html" style="text-decoration: none; color: #8D98AF; "><i class="fa-solid fa-warehouse me-3"></i>categories</a></li>
            <li><a href="users.html" style="text-decoration: none; color: #8D98AF; "><i class="fa-solid fa-bell me-3"></i>Customers</a></li>
            <hr>
            <li><a href="#" style="text-decoration: none; color: #8D98AF; "><i class="fa-solid fa-message me-3"></i>Reviews</a></li>
            <li><a href="#" style="text-decoration: none; color: #8D98AF; "><i class="fa-solid fa-gear me-3"></i>Settings</a></li>
            <li><a onclick="logOut()" style="cursor:pointer; text-decoration: none; color: #8D98AF"><i class="fa-solid fa-arrow-right-from-bracket me-3"></i>Logout</a></li>
          </ul>
        </div>
      </div>


<div class="container-fluid ">
  <div class="row">
   <!-- Sidebar -->
          <div class="col-md-2 sidebar d-md-block d-none">
          <ul class="listItem">
            <li>
              <a href="dashboard.html" class="nav-link">
                <i class="fa-solid fa-house me-lg-3 me-md-1"></i>
                <span>Dashboard</span>
              </a>
            </li>
            <li>
              <a href="orders.html" class="nav-link">
                <i class="fa-solid fa-cart-shopping me-lg-3 me-md-1"></i>
                <span>Orders</span>
              </a>
            </li>
            <li>
              <a href="product.html" class="nav-link">
                <i class="fa-solid fa-user me-lg-3 me-md-1"></i>
                <span>Products</span>
              </a>
            </li>
            <li>
              <a href="categories.html" class="nav-link">
                <i class="fa-solid fa-warehouse me-lg-3 me-md-1"></i>
                <span>Category</span>
              </a>
            </li>
            <li>
              <a href="users.html" class="nav-link">
                <i class="fa-solid fa-bell me-lg-3 me-md-1"></i>
                <span>Customers</span>
              </a>
            </li>
            <hr>
            <li>
              <a href="#" class="nav-link">
                <i class="fa-solid fa-message me-lg-3 me-md-1"></i>
                <span>Reviews</span>
              </a>
            </li>
            <li>
              <a href="#" class="nav-link">
                <i class="fa-solid fa-gear me-lg-3 me-md-1"></i>
                <span>Settings</span>
              </a>
            </li>
            <li class="mt-5">
              <a href="#" class="nav-link  Dashbutton" onclick="logOut()">
                <i class="fa-solid fa-arrow-right-from-bracket me-lg-3 me-md-1"></i>
                <span>Logout</span>
              </a>
            </li>
          </ul>
        </div>

    <!-- Main Content -->
    <div class="col-md-10 p-4">
      <!-- Top Metrics -->
      <div class="row g-3 mb-4 mt-lg-5"  >
        <div class="col-md-3">
          <div class="metric-card">
  <h5>Total Sales (Yearly)</h5>
  <h3>â‚¦0</h3>
  <small class="text-success">+4.2%</small>
  <small class="text-success">% </small>
  <i class="fa-light fa-arrow-up" style="color: red;"></i>
  <small>Compared to (â‚¦0 last year)</small>
</div>

        </div>
        <div class="col-md-3">
          <div class="metric-card" id="daily">
            <h5>Total Sales (Daily)</h5>
            <h3>â‚¦0</h3>
            <small class="text-success">% vs yesterday</small>
          </div>
        </div>
        <div class="col-md-3">
          <div class="metric-card" id="weekly">
            <h5>Total Sales (Weekly)</h5>
            <h3>â‚¦0</h3>
            <small class="text-danger">% vs last week</small>
          </div>
        </div>
        <div class="col-md-3">
          <div class="metric-card" id="monthly">
            <h5>Total Sales (Monthly)</h5>
            <h3>â‚¦0</h3>
            <small class="text-success">% vs last month</small>
          </div>
        </div>
      </div>

      <!-- Charts -->
      <div class="row g-3 mb-4">
        <div class="col-md-8">
               <div class="">
                <div class="card shadow-sm">
                  <div class="card-body">
                    <div class="d-flex flex-wrap justify-content-between align-items-center mb-2">
                      <h5 class="fw-semibold mb-2 mb-sm-0">Orders Over Time </h5>
                      <div class="d-flex align-items-center gap-2">
                        <select id="monthSelect" class="form-select form-select-sm" style="width: 180px;">
                          <option value="">Current Month</option>
                        </select>
                        <div class="form-check form-switch ms-2">
                          <input class="form-check-input" type="checkbox" id="compareToggle">
                          <label class="form-check-label small" for="compareToggle">Compare prev. month</label>
                        </div>
                      </div>
                    </div>
                    <canvas id="ordersOverTimeChart" height="130"></canvas>
                    <div class="mt-3 text-end text-muted small" id="monthlySummary"></div>
                  </div>
                </div>
              </div>
              </div>
        <div class="col-md-4">
                <div class="card shadow-sm p-4">
                  <h6 class="fw-bold mb-4">Last 7 Days Sales</h6>
                  <div class="d-flex flex-column align-items-start">
                    <h4 id="itemsSold" class="fw-bold mb-0">0</h4>
                    <p class="text-muted small mb-2">Items Sold</p>
                    <h4 id="revenue" class="fw-bold mb-0">â‚¦0</h4>
                    <p class="text-muted small mb-3">Revenue</p>
                  </div>
                  <canvas id="salesBarChart" height="250"></canvas>
              </div>
              </div>
      </div>

      <!-- Best Selling Products + Doughnut -->
       
      <div class="row g-3 mb-4">
      <div class="col-md-6">
                <div class="card p-3 h-100">
                  <div class="d-flex align-items-center justify-content-between mb-2">
                    <h6 class="fw-bold">Recent Transactions</h6>
                  </div>
                  <div class="table-responsive">
                    <table class="table align-middle mb-0">
                      <thead>
                        <tr style="color: #8D98AF;">
                          <th>Date</th>
                          <th>Name</th>
                          <th>Amount</th>
                          <th>Status</th>
                        </tr>
                      </thead>
                      <tbody id="recentTransactions">
                        <!-- Latest 5 orders will be inserted here dynamically -->
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
       
        

       <div class="col-md-6">
                <div class="card p-3">
                  <h6>Top Products by Units Sold</h6>
                  <div class="table-responsive">
                    <table class="table align-middle">
                      <thead style="color:#8D98AF;">
                        <tr>
                          <th>Name</th>
                          <th>Price</th>
                          <th>Units Sold</th>
                        </tr>
                      </thead>
                      <tbody id="topProductsBody">
                        <!-- JS will inject rows here -->
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>







        
      </div>

     

    </div>
  </div>
</div>

<script>
  // Line Chart
  new Chart(document.getElementById('trendChart'), {
    type: 'line',
    data: {
      labels: ['Jan','Feb','Mar','Apr','May','Jun'],
      datasets: [
        {label:'Orders', data:[200,250,180,300,270,350], borderColor:'#28a745', fill:false},
        {label:'Revenue', data:[300,400,350,500,450,600], borderColor:'#dc3545', fill:false}
      ]
    }
  });

  // Bar Chart
  new Chart(document.getElementById('visitChart'), {
    type: 'bar',
    data: {
      labels: ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],
      datasets: [{label:'Visits', data:[120,150,180,200,170,140,190], backgroundColor:'#0d6efd'}]
    }
  });

  // Doughnut Chart
  new Chart(document.getElementById('productChart'), {
    type: 'doughnut',
    data: {
      labels: ['Berry Bites','Organic Almond Delight','Coconut Crunch'],
      datasets: [{data:[45,32,23], backgroundColor:['#0d6efd','#20c997','#ffc107']}]
    }
  });

    
</script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
  async function loadTopProducts() {
    try {
      const res = await fetch("http://localhost:3001/amazon/document/api/orders");
      if (!res.ok) throw new Error("Failed to fetch orders");
      const orders = await res.json();
      // Aggregate products
      const productMap = {};
      orders.forEach(order => {
        order.items?.forEach(item => {
          if (!productMap[item.name]) {
            productMap[item.name] = {
              name: item.name,
              price: item.price,
              image: item.image || "https://via.placeholder.com/50",
              units: 0
            };
          }
          productMap[item.name].units += item.quantity;
        });
      });
      // Sort by units sold (descending) & limit to top 5
      const topProducts = Object.values(productMap)
        .sort((a, b) => b.units - a.units)
        .slice(0, 5);
      // Render table
      const tbody = document.getElementById("topProductsBody");
      tbody.innerHTML = "";
      topProducts.forEach(p => {
        const row = `
          <tr>
            <td>
              <div class="d-flex align-items-center">
                <img src="${p.image}" alt="${p.name}"
                     class="rounded me-2"
                     style="width:40px; height:40px; object-fit:cover;">
                ${p.name}
              </div>
            </td>
            <td>â‚¦${p.price.toLocaleString()}</td>
            <td>${p.units}</td>
          </tr>
        `;
        tbody.insertAdjacentHTML("beforeend", row);
      });
    } catch (err) {
      console.error("Error loading top products:", err);
    }
  }
  // Call function when DOM ready
  loadTopProducts();
});
</script>

<!-- LOAD RECENT TRANSACTION ON DASHBOARD  -->
     <script>
    async function loadRecentTransactions() {
      try {
        const res = await fetch("http://localhost:3001/amazon/document/api/orders");
        const orders = await res.json();
        const tbody = document.getElementById("recentTransactions");
        tbody.innerHTML = "";
        if (!orders.length) {
          tbody.innerHTML = `<tr><td colspan="4" class="text-center">No transactions found</td></tr>`;
          return;
        }
        // Sort by newest and take latest 5
        const latestOrders = orders
          .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
          .slice(0, 5);
        latestOrders.forEach(order => {
          // Format name as First L.
          const first = order.customerSnapshot?.firstName || "";
          const last = order.customerSnapshot?.lastName || "";
          const displayName = last ? `${first} ${last[0]}.` : first || "Unknown";
          const date = new Date(order.createdAt).toLocaleDateString("en-GB"); // DD/MM/YYYY
          const amount = `â‚¦${order.totalAmount.toLocaleString()}`;
          // Decide status: use paymentStatus as the key indicator
          let badgeClass = "";
          if (order.paymentStatus?.toLowerCase() === "paid") {
            badgeClass = "badge bg-success-subtle text-success";
          } else if (order.paymentStatus?.toLowerCase() === "pending") {
            badgeClass = "badge bg-secondary-subtle text-secondary";
          } else {
            badgeClass = "badge bg-danger-subtle text-danger";
          }
          const row = `
            <tr>
              <td>${date}</td>
              <td>${displayName}</td>
              <td>${amount}</td>
              <td><span class="${badgeClass}">${order.paymentStatus}</span></td>
            </tr>
          `;
          tbody.insertAdjacentHTML("beforeend", row);
        });
      } catch (err) {
        console.error("Error loading recent transactions:", err);
      }
    }
    // Load on page start
    loadRecentTransactions();
    </script>




    <script>
      // Notification feed for all orders
let lastSeenAdminOrderTime = localStorage.getItem("lastSeenAdminOrderTime")
  ? new Date(localStorage.getItem("lastSeenAdminOrderTime"))
  : new Date(0);
document.addEventListener("DOMContentLoaded", () => {
  loadAllOrdersFeed();
  // :white_check_mark: Mark as seen when bell clicked
  document.body.addEventListener("click", (e) => {
    if (e.target.closest(".btnSharp")) {
      const badges = [
        document.getElementById("notificationBadge"),
        document.getElementById("notificationBadge1"),
      ];
      badges.forEach((badge) => {
        if (badge) badge.style.display = "none";
      });
      localStorage.setItem("lastSeenAdminOrderTime", new Date().toISOString());
    }
  });
  // :repeat: Auto-refresh every 30s
  setInterval(loadAllOrdersFeed, 30000);
});
async function loadAllOrdersFeed() {
  try {
    const res = await fetch("http://localhost:3001/amazon/document/api/orders");
    const orders = await res.json();
    // :white_check_mark: Sort newest â†’ oldest
    const sortedOrders = orders.sort(
      (a, b) => new Date(b.createdAt) - new Date(a.createdAt)
    );
    const feeds = [
      document.getElementById("activityFeed"),
      document.getElementById("activityFeed1"),
    ];
    feeds.forEach((feed) => {
      if (!feed) return;
      feed.innerHTML = "";
      if (sortedOrders.length === 0) {
        feed.innerHTML = `<li class="text-muted text-center">No recent orders</li>`;
        return;
      }
      // :white_check_mark: Show 5 latest orders
      sortedOrders.slice(0, 5).forEach((order) => {
        const firstName = order.customerSnapshot?.firstName || "Unknown";
        const lastName = order.customerSnapshot?.lastName
          ? order.customerSnapshot.lastName.charAt(0) + "."
          : "";
        const city = order.customerSnapshot?.city || "N/A";
        const total = order.totalAmount
          ? order.totalAmount.toLocaleString()
          : "0";
        const payment = order.paymentStatus || "pending";
        const createdAt = new Date(order.createdAt);
        const timeAgo = formatTimeAgo(createdAt);
        const badgeClass =
          payment.toLowerCase() === "paid"
            ? "bg-success-subtle text-success"
            : payment.toLowerCase() === "failed"
            ? "bg-danger-subtle text-danger"
            : "bg-warning-subtle text-warning";
        const avatar = `https://ui-avatars.com/api/?name=${firstName}+${lastName}&background=random`;
        feed.insertAdjacentHTML(
          "beforeend",
          `
          <li class="d-flex align-items-center mb-3 border-bottom pb-2">
            <img src="${avatar}" class="rounded-circle me-3" width="40" height="40" alt="${firstName}">
            <div class="flex-grow-1">
              <div class="d-flex justify-content-between">
                <strong>${firstName} ${lastName}</strong>
                <small class="text-muted">${timeAgo}</small>
              </div>
              <div class="text-muted small">
                Ordered from <b>${city}</b> â€¢ â‚¦${total}
              </div>
            </div>
            <span class="badge rounded-pill ${badgeClass}">${payment}</span>
          </li>
          `
        );
      });
      // :white_check_mark: Footer
      feed.insertAdjacentHTML(
        "beforeend",
        `
        <li class="text-center mt-2">
          <button class="btn btn-success w-100 fw-semibold"
            onclick="window.location.href='notifications.html'">
            View all notifications
          </button>
        </li>
        `
      );
    });
    // :white_check_mark: Badge logic for unseen orders
    const newOrders = sortedOrders.filter(
      (o) => new Date(o.createdAt) > lastSeenAdminOrderTime
    );
    updateNotificationBadge(newOrders.length);
  } catch (err) {
    console.error("Error loading all orders feed:", err);
  }
}
// :clock3: Helper
function formatTimeAgo(date) {
  const now = new Date();
  const seconds = Math.floor((now - date) / 1000);
  const intervals = [
    { label: "year", seconds: 31536000 },
    { label: "month", seconds: 2592000 },
    { label: "day", seconds: 86400 },
    { label: "hour", seconds: 3600 },
    { label: "min", seconds: 60 },
  ];
  for (const interval of intervals) {
    const count = Math.floor(seconds / interval.seconds);
    if (count >= 1)
      return `${count} ${interval.label}${count > 1 ? "s" : ""} ago`;
  }
  return "just now";
}
// :bell: Update badge
function updateNotificationBadge(count) {
  const badges = [
    document.getElementById("notificationBadge"),
    document.getElementById("notificationBadge1"),
  ];
  badges.forEach((badge) => {
    if (!badge) return;
    if (count > 0) {
      badge.style.display = "inline-block";
      badge.textContent = count > 9 ? "9+" : count;
    } else {
      badge.style.display = "none";
    }
  });
}

    </script>

    <script>
      async function loadYearlySales() {
  try {
    const res = await fetch("http://localhost:3001/amazon/document/api/orders");
    const orders = await res.json();

    if (!Array.isArray(orders) || orders.length === 0) {
      console.warn("No orders found");
      return;
    }

    const currentYear = new Date().getFullYear();
    const lastYear = currentYear - 1;

    // Filter only paid orders
    const paidOrders = orders.filter(o => o.paymentStatus?.toLowerCase() === "paid");

    // Group totals by year
    const yearlyTotals = paidOrders.reduce((acc, order) => {
      const year = new Date(order.createdAt).getFullYear();
      acc[year] = (acc[year] || 0) + (order.totalAmount || 0);
      return acc;
    }, {});

    const currentYearTotal = yearlyTotals[currentYear] || 0;
    const lastYearTotal = yearlyTotals[lastYear] || 0;

    let percentageChange = 0;
    if (lastYearTotal > 0) {
      percentageChange = ((currentYearTotal - lastYearTotal) / lastYearTotal) * 100;
    } else if (currentYearTotal > 0) {
      percentageChange = 100;
    }

    // === UPDATE THE UI ===
    const card = document.querySelector(".metric-card");
    if (!card) return console.warn("No .metric-card found");

    const salesValue = card.querySelector("h3");
    const percentText = card.querySelector("small.text-success");
    const compareText = card.querySelector("small:last-of-type");
    const arrowIcon = card.querySelector("i");

    // Animate the count-up for total sales
    if (salesValue) {
      animateNumber(salesValue, currentYearTotal);
    }

    // Animate fade for percentage and text
    if (percentText) {
      percentText.textContent = `${percentageChange.toFixed(1)}%`;
      percentText.classList.toggle("text-success", percentageChange >= 0);
      percentText.classList.toggle("text-danger", percentageChange < 0);
      fadeElement(percentText);
    }

    if (arrowIcon) {
      arrowIcon.classList.remove("fa-arrow-up", "fa-arrow-down");
      arrowIcon.classList.add(percentageChange >= 0 ? "fa-arrow-up" : "fa-arrow-down");
      arrowIcon.style.color = percentageChange >= 0 ? "green" : "red";
      fadeElement(arrowIcon);
    }

    if (compareText) {
      compareText.textContent = `Compared to (â‚¦${lastYearTotal.toLocaleString()} last year)`;
      fadeElement(compareText);
    }

  } catch (err) {
    console.error("Error loading yearly sales:", err);
  }
}

// Helper: Animate number count-up
function animateNumber(element, target) {
  const duration = 1200; // 1.2 seconds
  const start = parseInt(element.textContent.replace(/[â‚¦,]/g, "")) || 0;
  const startTime = performance.now();

  function update(currentTime) {
    const progress = Math.min((currentTime - startTime) / duration, 1);
    const value = Math.floor(progress * (target - start) + start);
    element.textContent = `â‚¦${value.toLocaleString()}`;
    if (progress < 1) requestAnimationFrame(update);
  }

  requestAnimationFrame(update);
  fadeElement(element);
}

// Helper: Fade animation
function fadeElement(el) {
  el.style.transition = "opacity 0.6s ease";
  el.style.opacity = 0;
  setTimeout(() => (el.style.opacity = 1), 100);
}

// Load on startup
document.addEventListener("DOMContentLoaded", () => {
  loadYearlySales();
  // Auto-refresh every 60 seconds
  setInterval(loadYearlySales, 60000);
});

    </script>

    <script>
      async function loadDailySales() {
  try {
    const res = await fetch("http://localhost:3001/amazon/document/api/orders");
    const orders = await res.json();

    if (!Array.isArray(orders) || orders.length === 0) {
      console.warn("No orders found");
      return;
    }

    // Get today's and yesterday's dates
    const today = new Date();
    const yesterday = new Date(today);
    yesterday.setDate(today.getDate() - 1);

    const todayStr = today.toISOString().split("T")[0];
    const yesterdayStr = yesterday.toISOString().split("T")[0];

    // Filter only paid orders
    const paidOrders = orders.filter(o => o.paymentStatus?.toLowerCase() === "paid");

    // Group totals by day (YYYY-MM-DD)
    const dailyTotals = paidOrders.reduce((acc, order) => {
      const date = new Date(order.createdAt).toISOString().split("T")[0];
      acc[date] = (acc[date] || 0) + (order.totalAmount || 0);
      return acc;
    }, {});

    const todayTotal = dailyTotals[todayStr] || 0;
    const yesterdayTotal = dailyTotals[yesterdayStr] || 0;

    // Calculate percentage difference
    let percentageChange = 0;
    if (yesterdayTotal > 0) {
      percentageChange = ((todayTotal - yesterdayTotal) / yesterdayTotal) * 100;
    } else if (todayTotal > 0) {
      percentageChange = 100;
    }

    // === UPDATE THE UI (Only for #daily card) ===
    const card = document.getElementById("daily");
    if (!card) return console.warn("No #daily element found");

    const salesValue = card.querySelector("h3");
    const percentText = card.querySelector("small");

    if (salesValue) animateNumber(salesValue, todayTotal);

    if (percentText) {
      percentText.textContent = `${percentageChange.toFixed(1)}% vs yesterday`;
      percentText.classList.toggle("text-success", percentageChange >= 0);
      percentText.classList.toggle("text-danger", percentageChange < 0);
      fadeElement(percentText);
    }

  } catch (error) {
    console.error("Error loading daily sales:", error);
  }
}

// === Helper: Animate number count-up ===
function animateNumber(element, target) {
  const duration = 1200;
  const start = parseInt(element.textContent.replace(/[â‚¦,]/g, "")) || 0;
  const startTime = performance.now();

  function update(currentTime) {
    const progress = Math.min((currentTime - startTime) / duration, 1);
    const value = Math.floor(progress * (target - start) + start);
    element.textContent = `â‚¦${value.toLocaleString()}`;
    if (progress < 1) requestAnimationFrame(update);
  }

  requestAnimationFrame(update);
  fadeElement(element);
}

// === Helper: Fade-in animation ===
function fadeElement(el) {
  el.style.transition = "opacity 0.6s ease, transform 0.3s ease";
  el.style.opacity = 0;
  el.style.transform = "translateY(10px)";
  setTimeout(() => {
    el.style.opacity = 1;
    el.style.transform = "translateY(0)";
  }, 100);
}

// === Initialize on page load ===
document.addEventListener("DOMContentLoaded", () => {
  loadDailySales();
  setInterval(loadDailySales, 60000); // refresh every 60 seconds
});

    </script>

    <script>
      async function loadWeeklySales() {
  try {
    const res = await fetch("http://localhost:3001/amazon/document/api/orders");
    const orders = await res.json();

    if (!Array.isArray(orders) || orders.length === 0) {
      console.warn("No orders found");
      return;
    }

    const paidOrders = orders.filter(o => o.paymentStatus?.toLowerCase() === "paid");

    // Get the current date and determine current & last week ranges
    const now = new Date();
    const currentWeekStart = new Date(now);
    currentWeekStart.setDate(now.getDate() - now.getDay()); // Sunday
    currentWeekStart.setHours(0, 0, 0, 0);

    const lastWeekStart = new Date(currentWeekStart);
    lastWeekStart.setDate(currentWeekStart.getDate() - 7);
    const lastWeekEnd = new Date(currentWeekStart);
    lastWeekEnd.setDate(currentWeekStart.getDate() - 1);
    lastWeekEnd.setHours(23, 59, 59, 999);

    // Sum totals for current week and last week
    let currentWeekTotal = 0;
    let lastWeekTotal = 0;

    paidOrders.forEach(order => {
      const orderDate = new Date(order.createdAt);
      const amount = order.totalAmount || 0;

      if (orderDate >= currentWeekStart && orderDate <= now) {
        currentWeekTotal += amount;
      } else if (orderDate >= lastWeekStart && orderDate <= lastWeekEnd) {
        lastWeekTotal += amount;
      }
    });

    // Calculate percentage difference
    let percentageChange = 0;
    if (lastWeekTotal > 0) {
      percentageChange = ((currentWeekTotal - lastWeekTotal) / lastWeekTotal) * 100;
    } else if (currentWeekTotal > 0) {
      percentageChange = 100;
    }

    // === UPDATE UI ===
    const card = document.getElementById("weekly");
    if (!card) return console.warn("No #weekly element found");

    const salesValue = card.querySelector("h3");
    const percentText = card.querySelector("small");

    if (salesValue) animateNumber(salesValue, currentWeekTotal);

    if (percentText) {
      percentText.textContent = `${percentageChange.toFixed(1)}% vs last week`;
      percentText.classList.toggle("text-success", percentageChange >= 0);
      percentText.classList.toggle("text-danger", percentageChange < 0);
      fadeElement(percentText);
    }

  } catch (error) {
    console.error("Error loading weekly sales:", error);
  }
}

// === Animate number count-up ===
function animateNumber(element, target) {
  const duration = 1200;
  const start = parseInt(element.textContent.replace(/[â‚¦,]/g, "")) || 0;
  const startTime = performance.now();

  function update(currentTime) {
    const progress = Math.min((currentTime - startTime) / duration, 1);
    const value = Math.floor(progress * (target - start) + start);
    element.textContent = `â‚¦${value.toLocaleString()}`;
    if (progress < 1) requestAnimationFrame(update);
  }

  requestAnimationFrame(update);
  fadeElement(element);
}

// === Fade-in animation ===
function fadeElement(el) {
  el.style.transition = "opacity 0.6s ease, transform 0.3s ease";
  el.style.opacity = 0;
  el.style.transform = "translateY(10px)";
  setTimeout(() => {
    el.style.opacity = 1;
    el.style.transform = "translateY(0)";
  }, 100);
}

// === Initialize on page load ===
document.addEventListener("DOMContentLoaded", () => {
  loadWeeklySales();
  setInterval(loadWeeklySales, 60000); // refresh every 60 seconds
});

    </script>

    <script>
      async function loadMonthlySales() {
  try {
    const res = await fetch("http://localhost:3001/amazon/document/api/orders");
    const orders = await res.json();

    if (!Array.isArray(orders) || orders.length === 0) {
      console.warn("No orders found");
      return;
    }

    // Filter only paid orders
    const paidOrders = orders.filter(o => o.paymentStatus?.toLowerCase() === "paid");

    const now = new Date();
    const currentMonth = now.getMonth(); // 0 = Jan, 11 = Dec
    const currentYear = now.getFullYear();

    // Define last month (handle January case)
    const lastMonth = currentMonth === 0 ? 11 : currentMonth - 1;
    const lastMonthYear = currentMonth === 0 ? currentYear - 1 : currentYear;

    // Calculate totals
    let currentMonthTotal = 0;
    let lastMonthTotal = 0;

    paidOrders.forEach(order => {
      const date = new Date(order.createdAt);
      const amount = order.totalAmount || 0;

      if (date.getFullYear() === currentYear && date.getMonth() === currentMonth) {
        currentMonthTotal += amount;
      } else if (date.getFullYear() === lastMonthYear && date.getMonth() === lastMonth) {
        lastMonthTotal += amount;
      }
    });

    // Calculate percentage difference
    let percentageChange = 0;
    if (lastMonthTotal > 0) {
      percentageChange = ((currentMonthTotal - lastMonthTotal) / lastMonthTotal) * 100;
    } else if (currentMonthTotal > 0) {
      percentageChange = 100;
    }

    // === UPDATE UI ===
    const card = document.getElementById("monthly");
    if (!card) return console.warn("No #monthly element found");

    const salesValue = card.querySelector("h3");
    const percentText = card.querySelector("small");

    if (salesValue) animateNumber(salesValue, currentMonthTotal);

    if (percentText) {
      percentText.textContent = `${percentageChange.toFixed(1)}% vs last month`;
      percentText.classList.toggle("text-success", percentageChange >= 0);
      percentText.classList.toggle("text-danger", percentageChange < 0);
      fadeElement(percentText);
    }

  } catch (error) {
    console.error("Error loading monthly sales:", error);
  }
}

// === Animate number count-up ===
function animateNumber(element, target) {
  const duration = 1200;
  const start = parseInt(element.textContent.replace(/[â‚¦,]/g, "")) || 0;
  const startTime = performance.now();

  function update(currentTime) {
    const progress = Math.min((currentTime - startTime) / duration, 1);
    const value = Math.floor(progress * (target - start) + start);
    element.textContent = `â‚¦${value.toLocaleString()}`;
    if (progress < 1) requestAnimationFrame(update);
  }

  requestAnimationFrame(update);
  fadeElement(element);
}

// === Fade-in animation ===
function fadeElement(el) {
  el.style.transition = "opacity 0.6s ease, transform 0.3s ease";
  el.style.opacity = 0;
  el.style.transform = "translateY(10px)";
  setTimeout(() => {
    el.style.opacity = 1;
    el.style.transform = "translateY(0)";
  }, 100);
}

// === Initialize on page load ===
document.addEventListener("DOMContentLoaded", () => {
  loadMonthlySales();
  setInterval(loadMonthlySales, 60000); // refresh every 60 seconds
});

    </script>
    <script>
      
    </script>

    <!-- <script>
       document.addEventListener("DOMContentLoaded", async () => {
    const ctx = document.getElementById("ordersOverTimeChart").getContext("2d");
    const monthSelect = document.getElementById("monthSelect");
    const compareToggle = document.getElementById("compareToggle");
    const summary = document.getElementById("monthlySummary");
    let allOrders = [];
    let chart;
    // :white_check_mark: Fetch all orders (real data)
    async function fetchOrders() {
      try {
        const res = await fetch("http://localhost:3001/amazon/document/api/orders");
        if (!res.ok) throw new Error("Failed to fetch orders");
        const data = await res.json();
        allOrders = data;
        populateMonthDropdown();
        renderChart();
      } catch (err) {
        console.error(":x: Error fetching orders:", err);
      }
    }
    // :white_check_mark: Build month dropdown dynamically
    function populateMonthDropdown() {
      const months = [...new Set(
        allOrders.map(o => {
          const d = new Date(o.createdAt);
          return d.toLocaleString("default", { month: "long", year: "numeric" });
        })
      )];
      months.forEach(month => {
        const opt = document.createElement("option");
        opt.value = month;
        opt.textContent = month;
        monthSelect.appendChild(opt);
      });
    }
    // :white_check_mark: Compute daily paid/pending stats
    function getOrdersData(monthLabel = "") {
      const now = new Date();
      let filtered = allOrders;
      if (monthLabel) {
        filtered = allOrders.filter(o => {
          const d = new Date(o.createdAt);
          return d.toLocaleString("default", { month: "long", year: "numeric" }) === monthLabel;
        });
      } else {
        filtered = allOrders.filter(o => {
          const d = new Date(o.createdAt);
          return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
        });
      }
      const daily = {};
      filtered.forEach(order => {
        const d = new Date(order.createdAt);
        const day = d.toLocaleDateString("en-GB", { day: "2-digit", month: "short" });
        if (!daily[day]) daily[day] = { paidCount: 0, pendingCount: 0, paidRevenue: 0, pendingRevenue: 0 };
        if (order.paymentStatus?.toLowerCase() === "paid") {
          daily[day].paidCount += 1;
          daily[day].paidRevenue += order.totalAmount || 0;
        } else {
          daily[day].pendingCount += 1;
          daily[day].pendingRevenue += order.totalAmount || 0;
        }
      });
      return {
        days: Object.keys(daily),
        paidCounts: Object.values(daily).map(d => d.paidCount),
        pendingCounts: Object.values(daily).map(d => d.pendingCount),
        paidRevenue: Object.values(daily).map(d => d.paidRevenue),
        pendingRevenue: Object.values(daily).map(d => d.pendingRevenue),
        totals: {
          paidOrders: Object.values(daily).reduce((a,b)=>a+b.paidCount,0),
          pendingOrders: Object.values(daily).reduce((a,b)=>a+b.pendingCount,0),
          paidRevenue: Object.values(daily).reduce((a,b)=>a+b.paidRevenue,0),
          pendingRevenue: Object.values(daily).reduce((a,b)=>a+b.pendingRevenue,0),
        }
      };
    }
    // :white_check_mark: Render chart (with paid vs pending)
    function renderChart(selectedMonth = "", compare = false) {
      const current = getOrdersData(selectedMonth);
      const prevMonthLabel = compare ? getPrevMonth(selectedMonth) : null;
      const previous = compare ? getOrdersData(prevMonthLabel) : null;
      if (chart) chart.destroy();
      const datasets = [
        {
          label: "Paid Orders",
          data: current.paidCounts,
          borderColor: "#198754",
          backgroundColor: "rgba(25, 135, 84, 0.15)",
          fill: true,
          tension: 0.3,
          yAxisID: "yOrders",
        },
        {
          label: "Pending Orders",
          data: current.pendingCounts,
          borderColor: "#FFC107",
          backgroundColor: "rgba(255, 193, 7, 0.15)",
          fill: true,
          tension: 0.3,
          yAxisID: "yOrders",
        },
        {
          label: "Paid Revenue (â‚¦)",
          data: current.paidRevenue,
          borderColor: "#0D6EFD",
          backgroundColor: "rgba(13, 110, 253, 0.15)",
          fill: true,
          tension: 0.3,
          yAxisID: "yRevenue",
        },
        {
          label: "Pending Value (â‚¦)",
          data: current.pendingRevenue,
          borderColor: "#FD7E14",
          backgroundColor: "rgba(253, 126, 20, 0.15)",
          fill: true,
          tension: 0.3,
          yAxisID: "yRevenue",
        }
      ];
      if (compare && previous) {
        datasets.push({
          label: `Prev Month Paid Orders (${prevMonthLabel})`,
          data: previous.paidCounts,
          borderColor: "#6C757D",
          borderDash: [5, 5],
          tension: 0.3,
          yAxisID: "yOrders"
        });
      }
      chart = new Chart(ctx, {
        type: "line",
        data: { labels: current.days, datasets },
        options: {
          responsive: true,
          interaction: { mode: "index", intersect: false },
          plugins: {
            legend: { position: "top" },
            tooltip: {
              callbacks: {
                label: (ctx) => {
                  if (ctx.dataset.label.includes("â‚¦"))
                    return ` ${ctx.dataset.label}: â‚¦${ctx.parsed.y.toLocaleString()}`;
                  return ` ${ctx.dataset.label}: ${ctx.parsed.y} orders`;
                }
              }
            }
          },
          scales: {
            x: { grid: { display: false } },
            yOrders: {
              position: "left",
              title: { display: true, text: "Orders", color: "#000" },
              beginAtZero: true,
            },
            yRevenue: {
              position: "right",
              title: { display: true, text: "Revenue (â‚¦)", color: "#000" },
              beginAtZero: true,
              grid: { drawOnChartArea: false },
            }
          }
        }
      });
      // :white_check_mark: Summary totals below chart
      summary.innerHTML = `
        <span class="text-success fw-semibold">Paid Orders:</span> ${current.totals.paidOrders.toLocaleString()}
        (â‚¦${current.totals.paidRevenue.toLocaleString()})
        &nbsp; | &nbsp;
        <span class="text-warning fw-semibold">Pending Orders:</span> ${current.totals.pendingOrders.toLocaleString()}
        (â‚¦${current.totals.pendingRevenue.toLocaleString()})
      `;
    }
    // :white_check_mark: Get previous month label
    function getPrevMonth(label) {
      const d = label ? new Date(label) : new Date();
      d.setMonth(d.getMonth() - 1);
      return d.toLocaleString("default", { month: "long", year: "numeric" });
    }
    // Events
    monthSelect.addEventListener("change", (e) => {
      renderChart(e.target.value, compareToggle.checked);
    });
    compareToggle.addEventListener("change", () => {
      renderChart(monthSelect.value, compareToggle.checked);
    });
    fetchOrders();
  });
    </script> -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/js/all.min.js" integrity="sha512-b+nQTCdtTBIRIbraqNEwsjB6UvL3UEMkXnhzd8awtCYh0Kcsjl9uEgwVFVbhoj3uu1DO1ZMacNvLoyJJiNfcvg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
 <!-- âœ… Load SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>



<script src="./js/index.js"></script>

<script>

document.addEventListener("DOMContentLoaded", () => {
  const userName = localStorage.getItem("userName") || "Admin";

  // Time-based greeting
  const hour = new Date().getHours();
  let greeting =
    hour < 12 ? "Good morning" :
    hour < 18 ? "Good afternoon" :
    "Good evening";

  // Create toast element
  const toast = document.createElement("div");
  toast.id = "dashboardToast";
  toast.innerHTML = `
    <div class="toast-content">
      <strong>${greeting}, ${userName}! ðŸ‘‹</strong><br>
      <span>Welcome back to your dashboard.</span>
    </div>
  `;

  document.body.appendChild(toast);

  // Show animation
  setTimeout(() => toast.classList.add("show"), 100);

  // Hide after 5 seconds
  setTimeout(() => {
    toast.classList.remove("show");
    setTimeout(() => toast.remove(), 500);
  }, 5000);
});
</script>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  const ctx = document.getElementById("ordersOverTimeChart").getContext("2d");
  const monthSelect = document.getElementById("monthSelect");
  const compareToggle = document.getElementById("compareToggle");
  const summary = document.getElementById("monthlySummary");

  let allOrders = [];
  let chart;

  // === Fetch all orders (real data)
  async function fetchOrders() {
    try {
      const res = await fetch("http://localhost:3001/amazon/document/api/orders");
      if (!res.ok) throw new Error("Failed to fetch orders");
      const data = await res.json();
      allOrders = data;
      populateMonthDropdown();
      renderChart();
    } catch (err) {
      console.error("âŒ Error fetching orders:", err);
    }
  }

  // === Build month dropdown dynamically
  function populateMonthDropdown() {
    const months = [...new Set(
      allOrders.map(o => {
        const d = new Date(o.createdAt);
        return d.toLocaleString("default", { month: "long", year: "numeric" });
      })
    )];

    // Add default option
    const defaultOpt = document.createElement("option");
    defaultOpt.value = "";
    defaultOpt.textContent = "Current Month";
    monthSelect.appendChild(defaultOpt);

    // Add month options
    months.forEach(month => {
      const opt = document.createElement("option");
      opt.value = month;
      opt.textContent = month;
      monthSelect.appendChild(opt);
    });
  }

  // === Compute daily paid/pending stats
  function getOrdersData(monthLabel = "") {
    const now = new Date();
    let filtered = allOrders;

    if (monthLabel) {
      const [monthName, year] = monthLabel.split(" ");
      const monthIndex = new Date(`${monthName} 1, ${year}`).getMonth();
      filtered = allOrders.filter(o => {
        const d = new Date(o.createdAt);
        return d.getMonth() === monthIndex && d.getFullYear() === parseInt(year);
      });
    } else {
      filtered = allOrders.filter(o => {
        const d = new Date(o.createdAt);
        return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
      });
    }

    const daily = {};
    filtered.forEach(order => {
      const d = new Date(order.createdAt);
      const day = d.toLocaleDateString("en-GB", { day: "2-digit", month: "short" });
      if (!daily[day])
        daily[day] = { paidCount: 0, pendingCount: 0, paidRevenue: 0, pendingRevenue: 0 };

      if (order.paymentStatus?.toLowerCase() === "paid") {
        daily[day].paidCount += 1;
        daily[day].paidRevenue += order.totalAmount || 0;
      } else {
        daily[day].pendingCount += 1;
        daily[day].pendingRevenue += order.totalAmount || 0;
      }
    });

    return {
      days: Object.keys(daily),
      paidCounts: Object.values(daily).map(d => d.paidCount),
      pendingCounts: Object.values(daily).map(d => d.pendingCount),
      paidRevenue: Object.values(daily).map(d => d.paidRevenue),
      pendingRevenue: Object.values(daily).map(d => d.pendingRevenue),
      totals: {
        paidOrders: Object.values(daily).reduce((a, b) => a + b.paidCount, 0),
        pendingOrders: Object.values(daily).reduce((a, b) => a + b.pendingCount, 0),
        paidRevenue: Object.values(daily).reduce((a, b) => a + b.paidRevenue, 0),
        pendingRevenue: Object.values(daily).reduce((a, b) => a + b.pendingRevenue, 0),
      }
    };
  }

  // === Render chart (with paid vs pending)
  function renderChart(selectedMonth = "", compare = false) {
    const current = getOrdersData(selectedMonth);
    const prevMonthLabel = compare ? getPrevMonth(selectedMonth) : null;
    const previous = compare ? getOrdersData(prevMonthLabel) : null;

    if (chart) chart.destroy();

    const datasets = [
      {
        label: "Paid Orders",
        data: current.paidCounts,
        borderColor: "#198754",
        backgroundColor: "rgba(25, 135, 84, 0.15)",
        fill: true,
        tension: 0.3,
        yAxisID: "yOrders",
      },
      {
        label: "Pending Orders",
        data: current.pendingCounts,
        borderColor: "#FFC107",
        backgroundColor: "rgba(255, 193, 7, 0.15)",
        fill: true,
        tension: 0.3,
        yAxisID: "yOrders",
      },
      {
        label: "Paid Revenue (â‚¦)",
        data: current.paidRevenue,
        borderColor: "#0D6EFD",
        backgroundColor: "rgba(13, 110, 253, 0.15)",
        fill: true,
        tension: 0.3,
        yAxisID: "yRevenue",
      },
      {
        label: "Pending Value (â‚¦)",
        data: current.pendingRevenue,
        borderColor: "#FD7E14",
        backgroundColor: "rgba(253, 126, 20, 0.15)",
        fill: true,
        tension: 0.3,
        yAxisID: "yRevenue",
      }
    ];

    if (compare && previous) {
      datasets.push({
        label: `Prev Month Paid Orders (${prevMonthLabel})`,
        data: previous.paidCounts,
        borderColor: "#6C757D",
        borderDash: [5, 5],
        tension: 0.3,
        yAxisID: "yOrders"
      });
    }

    chart = new Chart(ctx, {
      type: "line",
      data: { labels: current.days, datasets },
      options: {
        responsive: true,
        interaction: { mode: "index", intersect: false },
        plugins: {
          legend: { position: "top" },
          tooltip: {
            callbacks: {
              label: (ctx) => {
                if (ctx.dataset.label.includes("â‚¦"))
                  return ` ${ctx.dataset.label}: â‚¦${ctx.parsed.y.toLocaleString()}`;
                return ` ${ctx.dataset.label}: ${ctx.parsed.y} orders`;
              }
            }
          }
        },
        scales: {
          x: { grid: { display: false } },
          yOrders: {
            position: "left",
            title: { display: true, text: "Orders", color: "#000" },
            beginAtZero: true,
          },
          yRevenue: {
            position: "right",
            title: { display: true, text: "Revenue (â‚¦)", color: "#000" },
            beginAtZero: true,
            grid: { drawOnChartArea: false },
          }
        }
      }
    });

    // === Summary below chart
    summary.innerHTML = `
      <span class="text-success fw-semibold">Paid Orders:</span> ${current.totals.paidOrders.toLocaleString()}
      (â‚¦${current.totals.paidRevenue.toLocaleString()})
      &nbsp; | &nbsp;
      <span class="text-warning fw-semibold">Pending Orders:</span> ${current.totals.pendingOrders.toLocaleString()}
      (â‚¦${current.totals.pendingRevenue.toLocaleString()})
    `;
  }

  // === Get previous month label safely
  function getPrevMonth(label) {
    const now = new Date();
    let d;

    if (label) {
      const [monthName, year] = label.split(" ");
      const monthIndex = new Date(`${monthName} 1, ${year}`).getMonth();
      d = new Date(parseInt(year), monthIndex - 1, 1);
    } else {
      d = new Date(now.getFullYear(), now.getMonth() - 1, 1);
    }

    return d.toLocaleString("default", { month: "long", year: "numeric" });
  }

  // === Event Listeners
  monthSelect.addEventListener("change", (e) => {
    renderChart(e.target.value, compareToggle.checked);
  });

  compareToggle.addEventListener("change", () => {
    renderChart(monthSelect.value, compareToggle.checked);
  });

  // === Init
  fetchOrders();
});
</script>

<script>
  document.addEventListener("DOMContentLoaded", async () => {
  const ctx = document.getElementById("salesBarChart").getContext("2d");
  const itemsSoldEl = document.getElementById("itemsSold");
  const revenueEl = document.getElementById("revenue");
  try {
    const res = await fetch("http://localhost:3001/amazon/document/api/orders");
    if (!res.ok) throw new Error("Failed to fetch orders");
    const orders = await res.json();
    const today = new Date();
    const last7Days = Array.from({ length: 7 }).map((_, i) => {
      const d = new Date();
      d.setDate(today.getDate() - (6 - i));
      return d;
    });
    const labels = last7Days.map(d => d.toLocaleDateString("en-US", { day: "numeric" }));
    const dailyItems = Array(7).fill(0);
    const dailyRevenue = Array(7).fill(0);
    orders.forEach(order => {
      const orderDate = new Date(order.createdAt);
      last7Days.forEach((day, i) => {
        if (orderDate.toDateString() === day.toDateString()) {
          let items = 0;
          order.items.forEach(item => items += item.quantity || 0);
          dailyItems[i] += items;
          dailyRevenue[i] += order.totalAmount || 0;
        }
      });
    });
    const totalItems = dailyItems.reduce((a, b) => a + b, 0);
    const totalRevenue = dailyRevenue.reduce((a, b) => a + b, 0);
    itemsSoldEl.textContent = totalItems.toLocaleString();
    revenueEl.textContent = `â‚¦${totalRevenue.toLocaleString()}`;
    new Chart(ctx, {
      type: "bar",
      data: {
        labels,
        datasets: [
          {
            label: "Items Sold",
            data: dailyItems,
            backgroundColor: "#00C26F",
            yAxisID: "y",
          },
          {
            label: "Revenue",
            data: dailyRevenue,
            backgroundColor: "#007BFF",
            yAxisID: "y1",
          },
        ],
      },
      options: {
        responsive: true,
        interaction: { mode: "index", intersect: false },
        scales: {
          y: {
            beginAtZero: true,
            position: "left",
            title: { display: true, text: "Items Sold" },
          },
          y1: {
            beginAtZero: true,
            position: "right",
            title: { display: true, text: "Revenue (â‚¦)" },
            grid: { drawOnChartArea: false },
          },
        },
        plugins: {
          legend: { position: "bottom" },
          tooltip: {
            callbacks: {
              label: (ctx) => {
                const val = ctx.parsed.y;
                return ctx.dataset.label === "Revenue"
                  ? `â‚¦${val.toLocaleString()}`
                  : `${val.toLocaleString()} items`;
              },
            },
          },
          datalabels: {
            anchor: "end",
            align: "end",
            formatter: (value, ctx) => {
              return ctx.dataset.label === "Revenue"
                ? `â‚¦${value.toLocaleString()}`
                : value.toLocaleString();
            },
          },
        },
      },
      plugins: [ChartDataLabels],
    });
  } catch (err) {
    console.error("Error loading 7-day bar chart:", err);
  }
});
</script>

<style>
/* Toast container */
#dashboardToast {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background-color: #f0fff4;
  color: #333;
  padding: 14px 18px;
  border-radius: 10px;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
  font-family: "Poppins", sans-serif;
  font-size: 14px;
  opacity: 0;
  transform: translateY(100%);
  transition: all 0.5s ease;
  z-index: 9999;
}

/* When visible */
#dashboardToast.show {
  opacity: 1;
  transform: translateY(0);
}

/* Inner content styling */
.toast-content strong {
  font-size: 15px;
  color: #007b55;
}
.toast-content span {
  font-size: 13px;
  color: #333;
}
</style>


</body>
</html>
