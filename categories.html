<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>360 Organic Foodie - Super-Admin Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="style.css">

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    
  </style>
</head>
<body>
   <!-- Desktop Navbar (visible on md and up) -->
      <nav class="navbar navbar-expand-md bg-white d-none d-md-flex fixed-top">
        <div class="container-fluid">
          <img src="./images/Foodies logo without Banner 1.png" style="width: 50px; height: 50px" alt="">
          <span class="Navlogo1 d-md-none">360 Organic Foodie</span>
          <div class="collapse navbar-collapse">
            <ul class="navbar-nav me-auto">
              <li class="nav-item">
                <div class="input-group Navborder">
                  <button class="btn btn-outline-secondary border-0" type="button">
                    <i class="fas fa-search"></i>
                  </button>
                  <input type="text" class="form-control border-0" placeholder="Search here...">
                </div>
              </li>
            </ul>
            <form class="d-flex">
              <div class="d-flex align-items-center">
                <button class="text-reset me-3 btnSharp"><i class="fa-solid fa-cart-shopping"></i></button>
                <button class="text-reset me-4 btnSharp position-relative" onclick="toggleNotification(event)">
                  <i class="fas fa-bell"></i>
                  <span id="notificationBadge"
                        class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                        style="font-size: 0.7rem; display:none;">
                  </span>
                </button>
                <img id="userAvatar" class="me-3 rounded-circle" src="./images/cheerful-curly-man-with-bristle-points-left-wears-casual-clothes-spectacles 1.png" alt="User Avatar" width="40" height="40">
                <span id="userName" class="CustomP-14-400 me-3 text-dark fw-semibold"></span>
              </div>
            </form>
            <!-- notification pop-up  -->
              <div class="col-md-4" id="notificationPopUp">
                  <div class="card p-3" style=" overflow-y: auto;">
                    <h6 class="fw-bold mb-3">See all orders here</h6>
                    <ul class="list-unstyled" id="activityFeed"></ul>
                  </div>
              </div>
          </div>
        </div>
      </nav>
      <!-- Mobile Navbar (visible only on sm) -->
      <nav class="navbar bg-white px-3 d-flex justify-content-between align-items-center d-flex d-sm-flex d-md-none">
        <!-- Left side -->
        <div class="d-flex align-items-center">
          <!-- Hamburger -->
          <button class="btn p-0 me-3" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu">
            <i class="fa-solid fa-bars fs-4"></i>
          </button>
          <!-- Search -->
           <div class="search-container">
            <button class="btn p-0" id="mobileSearchBtn" aria-label="Open search">
              <i class="fa-solid fa-magnifying-glass fs-5 text-muted"></i>
            </button>
            <input
              type="text"
              id="mobileSearchInput"
              class="mobile-search-input"
              placeholder="Search dashboard..."
              aria-label="Search dashboard"
            />
          </div>
          <!-- <div class="search-container position-relative">
            <button class="btn p-0" id="mobileSearchBtn">
              <i class="fa-solid fa-magnifying-glass fs-5 text-muted"></i>
            </button>
            <input type="text" id="mobileSearchInput" class="form-control form-control-sm position-absolute"
              placeholder="Search..."
              style="width: 0; opacity: 0; transition: all 0.3s ease; left: 40px; top: 0; z-index: 1000;">
          </div> -->
        </div>
        <!-- Right side -->
        <div class="d-flex align-items-center">
          <!-- Bell -->
          <button class="text-reset me-1 btnSharp position-relative" onclick="toggleNotification(event)">
                  <i class="fas fa-bell"></i>
                  <span id="notificationBadge1"
                        class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                        style="font-size: 0.7rem; display:none;">
                  </span>
                </button>
          <!-- Profile -->
          <img src="./images/cheerful-curly-man-with-bristle-points-left-wears-casual-clothes-spectacles 1.png"
              class="rounded-circle"
              alt="Profile" width="40" height="40">
        </div>
              <div class="col-md-4" id="notificationPopUp1">
                  <div class="card p-3" style=" overflow-y: auto;">
                    <h6 class="fw-bold mb-3">Recent Activities in Your City</h6>
                    <ul class="list-unstyled" id="activityFeed1"></ul>
                  </div>
              </div>
      </nav>



      <!-- Sidebar (offcanvas for mobile) -->
      <div class="offcanvas offcanvas-start sidebar" tabindex="-1" id="sidebarMenu">
        <div class="offcanvas-header">
          <h5 class="offcanvas-title">Menu</h5>
          <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body p-3">
          <ul class="listItem">
            <li><a href="dashboard.html" class="active" style="text-decoration: none; color: #8D98AF; "><i class="fa-solid fa-house me-3"></i>Dashboard</a></li>
            <li><a href="orders.html" style="text-decoration: none; color: #8D98AF; "><i class="fa-solid fa-cart-shopping me-3"></i>Orders</a></li>
            <li><a href="product.html" style="text-decoration: none; color: #8D98AF; "><i class="fa-solid fa-user me-3"></i>Products</a></li>
            <li><a href="categories.html" style="text-decoration: none; color: #8D98AF; "><i class="fa-solid fa-warehouse me-3"></i>categories</a></li>
            <li><a href="users.html" style="text-decoration: none; color: #8D98AF; "><i class="fa-solid fa-bell me-3"></i>Customers</a></li>
            <hr>
            <li><a href="#" style="text-decoration: none; color: #8D98AF; "><i class="fa-solid fa-message me-3"></i>Reviews</a></li>
            <li><a href="#" style="text-decoration: none; color: #8D98AF; "><i class="fa-solid fa-gear me-3"></i>Settings</a></li>
            <li><a onclick="logOut()" style="cursor:pointer; text-decoration: none; color: #8D98AF"><i class="fa-solid fa-arrow-right-from-bracket me-3"></i>Logout</a></li>
          </ul>
        </div>
      </div>


<div class="container-fluid ">
  <div class="row">
 <!-- Sidebar -->
          <div class="col-md-2 sidebar d-md-block d-none">
          <ul class="listItem">
            <li>
              <a href="dashboard.html" class="nav-link">
                <i class="fa-solid fa-house me-lg-3 me-md-1"></i>
                <span>Dashboard</span>
              </a>
            </li>
            <li>
              <a href="orders.html" class="nav-link">
                <i class="fa-solid fa-cart-shopping me-lg-3 me-md-1"></i>
                <span>Orders</span>
              </a>
            </li>
            <li>
              <a href="product.html" class="nav-link">
                <i class="fa-solid fa-user me-lg-3 me-md-1"></i>
                <span>Products</span>
              </a>
            </li>
            <li>
              <a href="categories.html" class="nav-link">
                <i class="fa-solid fa-warehouse me-lg-3 me-md-1"></i>
                <span>Category</span>
              </a>
            </li>
            <li>
              <a href="users.html" class="nav-link">
                <i class="fa-solid fa-bell me-lg-3 me-md-1"></i>
                <span>Customers</span>
              </a>
            </li>
            <hr>
            <li>
              <a href="#" class="nav-link">
                <i class="fa-solid fa-message me-lg-3 me-md-1"></i>
                <span>Reviews</span>
              </a>
            </li>
            <li>
              <a href="#" class="nav-link">
                <i class="fa-solid fa-gear me-lg-3 me-md-1"></i>
                <span>Settings</span>
              </a>
            </li>
            <li class="mt-5">
              <a href="#" class="nav-link  Dashbutton" onclick="logOut()">
                <i class="fa-solid fa-arrow-right-from-bracket me-lg-3 me-md-1"></i>
                <span>Logout</span>
              </a>
            </li>
          </ul>
        </div>


    <!-- Main Content -->
    <div class="col-md-10 p-4">
      <div class="d-flex align-items-center justify-content-between mt-lg-5 search-fill">
            <h3>Catergory</h3>

            <div class="div">
                <!-- Button trigger ADD CATEGORY modal -->
                <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#exampleModal">
                + Add Category
                </button>

                <!-- ADD CATEGORY Modal -->
                <div class="modal fade " id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Add Category</h1>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="exampleFormControlInput1" class="form-label">Category Name</label>
                            <input type="text" class="form-control" id="catName" placeholder="">
                        </div>
                        <div>
                            <label for="exampleFormControlInput1" class="form-label">Category image</label>
                            <input type="text" class="form-control" id="catImage" placeholder="">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class=" btn-success" style="border: none; color: #00A859; background: transparent;"  data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-success" onclick="addCategory()">
                            <div class="spinner-border spinner-border-sm spin2" role="status">
                            <span class="visually-hidden">Loading...</span>
                            </div>
                            Create category
                        </button>
                    </div>
                    </div>
                </div>
                </div>

                <!-- Button UPDATE CATEGORY modal -->
                <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                Update category
                </button>

                <!-- UPDATE CATEGORY Modal -->
                <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="staticBackdropLabel">Update Category</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                         <div class="mb-3">
                            <label for="categorySelect1" class="form-label">Select Category</label>
                            <select id="categorySelect1" class="form-select" aria-label="Default select example">
                                <option value="">Choose a Category</option>
                            </select>
                            </div>

                            <div class="mb-3">
                            <label for="nameCat" class="form-label">Category Name</label>
                            <input type="text" class="form-control" id="nameCat" placeholder="enter new category name">
                            </div>

                            <div class="mb-3">
                            <label for="catImageUrl" class="form-label">Category Image</label>
                            <input type="text" class="form-control" id="catImageUrl" placeholder="enter new category image">
                            </div>
                    </div>
                    <div class="modal-footer">
                       <button type="button" class=" btn-success" style="border: none; color: #00A859; background: transparent;"  data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-success" onclick="updateCategory()">
                            <div class="spinner-border spinner-border-sm spin" role="status">
                            <span class="visually-hidden">Loading...</span>
                            </div>
                            update Category
                        </button> 
                    </div>
                    </div>
                </div>
                </div>
            </div>
      </div>

        <div class="row mt-5" id="categoriesContainer">
           

        </div>




<!-- Category Products Modal -->

<div class="modal fade" id="categoryProductsModal" tabindex="-1" aria-labelledby="categoryProductsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content border-0 shadow-sm rounded-4 overflow-hidden">
      
      <!-- Header -->
      <div class="modal-header border-0 flex-column align-items-start sticky-header">
        <a href="#" class="text-muted small mb-1" data-bs-dismiss="modal">
          &larr; Back
        </a>
        <h5 class="fw-bold mb-1" id="categoryProductsModalLabel">Category Name</h5>
        <div class="d-flex align-items-center mb-2">
          <h6 class="fw-semibold mb-0">Products</h6>
          <span id="productCount" class="ms-2 text-muted small"></span>
        </div>
      </div>

      <!-- Body -->
      <div class="modal-body py-3" id="categoryProductsContainer" style="max-height: 60vh; overflow-y: auto;">
        <!-- Products will be injected here -->
      </div>

      <!-- Footer -->
      <div class="modal-footer border-0 justify-content-center sticky-footer bg-white">
       <button class="btn btn-outline-success rounded-pill px-4 py-2 fw-semibold" 
        id="addProductBtn" type="button">
  <i class="fa-solid fa-plus"></i> Add Product
</button>

      </div>

    </div>
  </div>
</div>

 <!-- modal to add products starts here -->
               <div class="modal modal-xl" id="exampleModalToggle" aria-labelledby="exampleModalToggleLabel" tabindex="-1">

                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="row mt-5 p-3">
                                <div class="d-flex align-items-center justify-content-between">
                                    <h3>Products</h3>
                                    
                                </div>
                                <div class="col-md-8 mt-3">
                                    <h4>Information</h4>
                                    <form action="" onsubmit="addProductss(event)">
                                        <div class="mb-3">
                                            <label for="productName" class="form-label">Product Name</label>
                                            <input type="text" class="form-control" id="prodName" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="buyingPrice" class="form-label">product Description</label>
                                            <div class="form-floating">
                                                <textarea class="form-control" placeholder="Leave a comment here" id="prodDecsription" style="height: 100px"></textarea>
                                                <label for="floatingTextarea2">Product description</label>
                                            </div>
                                        </div>
                                        <hr class="mt-4" >
                                        <div class="mb-3">
                                             <label for="productImage" class="form-label fw-bold">Images</label>
                                            <div class="upload-box" onclick="document.getElementById('productImage').click()">
                                            <input type="text" id="productImage" accept="image/*">
                                            <div>
                                                <button class="btn btn-outline-success mb-2">Add File</button>
                                                <p class="mb-0">Or drag and drop files</p>
                                            </div>
                                            </div>
                                        
                                        </div>

                                        
                                        <hr class="mt-4" >

                                        <div class="row mt-4">
                                            <label for="threshold" class="form-label"> price</label>

                                            <div class="col-md-6 mt-3">
                                                <div class="mb-3">
                                                    <label for="threshold" class="form-label"> Product price</label>
                                                    <input type="number" class="form-control" id="prodPrice" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="threshold" class="form-label"> Number in Stock</label>
                                                    <input type="number" class="form-control" id="prodStock" required>
                                                </div>

                                                
                                            </div>
                                            <div class="col-md-6 mt-5">
                                                <div class="">
                                                    <select id="categorySelects" class="form-select ">
                                                    <option value="" >-- Select a Category --</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <hr class="mt-4">
                                            
                                            
                                      

                                        <div class="row mt-4">
                                            <p>Shipping</p>
                                            <div class="col-md-6 mt-3">
                                                <div class="mb-3">
                                                    
                                                    <label for="threshold" class="form-label">ingredients</label>
                                                    <input type="text" class="form-control" id="ingredients" required>
                                                    <label for="threshold" class="form-label">variety</label>
                                                    <input type="text" class="form-control" id="variety" required>
                                                    <label for="threshold" class="form-label">benefits</label>
                                                    <input type="text" class="form-control" id="benefits" required>
                                                </div>
                                               
                                            </div>
                                            
                                        </div>     
                                                                    <hr class="mt-4">
                               <div class="text-end">
    <button class="btn btn-outline-success" type="button">Cancel</button>
    <button class="btn btn-success" type="submit">Save</button>     
      </div>      
                                    </form>
                                </div>

                                
    

                            </div>
                        </div>
                    </div>
                </div>


<div class="modal fade" id="updateModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form id="updateForm">
        <div class="modal-header">
          <h5 class="modal-title">Update Product</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body row g-3">
          <input type="hidden" id="updateProductId">
          <div class="col-md-6">
            <label>Name</label>
            <input id="updateName" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label>Price</label>
            <input type="number" id="updatePrice" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label>Stock</label>
            <input type="number" id="updateStock" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label>Category</label>
            <select id="updateCategory" class="form-select" required>
              <option value="">Select category</option>
            </select>
          </div>
          <div class="col-12">
            <label>Description</label>
            <textarea id="updateDescription" class="form-control" rows="2" required></textarea>
          </div>
          <div class="col-12">
            <label>Images (comma separated)</label>
            <input id="updateImages" class="form-control">
          </div>
          <div class="col-12">
            <label>Variety (comma separated)</label>
            <input id="updateVariety" class="form-control">
          </div>
          <div class="col-12">
            <label>Benefits</label>
            <textarea id="updateBenefits" class="form-control" rows="2"></textarea>
          </div>
          <div class="col-12">
            <label>Ingredients (comma separated)</label>
            <input id="updateIngredients" class="form-control">
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">Save changes</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>





<script>
  // Line Chart
  new Chart(document.getElementById('trendChart'), {
    type: 'line',
    data: {
      labels: ['Jan','Feb','Mar','Apr','May','Jun'],
      datasets: [
        {label:'Orders', data:[200,250,180,300,270,350], borderColor:'#28a745', fill:false},
        {label:'Revenue', data:[300,400,350,500,450,600], borderColor:'#dc3545', fill:false}
      ]
    }
  });

  // Bar Chart
  new Chart(document.getElementById('visitChart'), {
    type: 'bar',
    data: {
      labels: ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],
      datasets: [{label:'Visits', data:[120,150,180,200,170,140,190], backgroundColor:'#0d6efd'}]
    }
  });

  // Doughnut Chart
  new Chart(document.getElementById('productChart'), {
    type: 'doughnut',
    data: {
      labels: ['Berry Bites','Organic Almond Delight','Coconut Crunch'],
      datasets: [{data:[45,32,23], backgroundColor:['#0d6efd','#20c997','#ffc107']}]
    }
  });

    
</script>


<!-- <script>
    async function loadCategories() {
  try {
    // Fetch categories
    const categoriesRes = await fetch("http://localhost:3001/amazon/document/api/categories");
    const categories = await categoriesRes.json();

    // Fetch products
    const productsRes = await fetch("http://localhost:3001/amazon/document/api/products");
    const products = await productsRes.json();

    // Count products per category
    const productCountMap = {};
    products.forEach(p => {
      if (p.categoryId) {
        productCountMap[p.categoryId] = (productCountMap[p.categoryId] || 0) + 1;
      }
    });

    // Display categories
    const container = document.getElementById("categoriesContainer");
    container.innerHTML = "";

    categories.forEach(cat => {
      const count = productCountMap[cat._id] || 0;

      const card = `
        <div class="col-md-3 mb-4">
          <div class="card h-100 shadow-sm">
            <img src="${cat.image}" class="card-img-top" alt="${cat.name}">
            <div class="card-body text-center">
              <h5 class="card-title">${cat.name}</h5>
              <p class="text-muted">${count} Products</p>
            </div>
          </div>
        </div>
      `;

      container.insertAdjacentHTML("beforeend", card);
    });
  } catch (err) {
    console.error("Error loading categories:", err);
  }
}

// Call it on page load
document.addEventListener("DOMContentLoaded", loadCategories);
</script> -->
<script>
async function loadCategories() {
  try {
    const categoriesRes = await fetch("http://localhost:3001/amazon/document/api/categories");
    const categories = await categoriesRes.json();

    const productsRes = await fetch("http://localhost:3001/amazon/document/api/products");
    const products = await productsRes.json();

    // Count products per category
    const productCountMap = {};
    products.forEach(p => {
      let catId = null;
      if (p.categoryId) catId = String(p.categoryId);
      if (p.category && p.category._id) catId = String(p.category._id);

      if (catId) {
        productCountMap[catId] = (productCountMap[catId] || 0) + 1;
      }
    });

    // Render categories
    const container = document.getElementById("categoriesContainer");
    container.innerHTML = "";

    categories.forEach(cat => {
      const count = productCountMap[String(cat._id)] || 0;

  const card = `
  <div class="col-md-6 col-lg-4 mb-4" id="cat-${cat._id}">
    <div class="image-wrap" style="cursor: pointer;" onclick="openCategoryProducts('${cat._id}', '${cat.name}')">
      <img src="${cat.image}" class="card-img-top" alt="${cat.name}" id="cat-img-${cat._id}">
    </div>
    <div class="card-body mt-3">
      <h5 class="card-title fw-bold" id="cat-name-${cat._id}">${cat.name}</h5>
      <p class="text-muted mt-3">${count} Product${count !== 1 ? "s" : ""}</p>
    </div>
    <button class="btn btn-danger" onclick="deleteCategory('${cat._id}')">Delete</button>
  </div>
`;



      container.insertAdjacentHTML("beforeend", card);
    });
  } catch (err) {
    console.error("Error loading categories:", err);
  }
}

// Delete category with confirmation
async function deleteCategory(categoryId) {
  Swal.fire({
    title: "Are you sure?",
    text: "This action will permanently delete the category.",
    icon: "warning",
    showCancelButton: true,
    confirmButtonColor: "#d33",
    cancelButtonColor: "#3085d6",
    confirmButtonText: "Yes, delete it!"
  }).then(async (result) => {
    if (result.isConfirmed) {
      try {
        const res = await fetch(`http://localhost:3001/amazon/document/api/categories/${categoryId}`, {
          method: "DELETE"
        });

        const data = await res.json();
        console.log("Delete response:", data);

        if (!res.ok) throw new Error(data.message || "Failed to delete category");

        // Remove category from DOM without reloading
        document.getElementById(`cat-${categoryId}`).remove();

        Swal.fire("Deleted!", "The category has been deleted.", "success");
      } catch (err) {
        console.error(err);
        Swal.fire("Error!", err.message, "error");
      }
    }
  });
}

document.addEventListener("DOMContentLoaded", loadCategories);



</script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/js/all.min.js" integrity="sha512-b+nQTCdtTBIRIbraqNEwsjB6UvL3UEMkXnhzd8awtCYh0Kcsjl9uEgwVFVbhoj3uu1DO1ZMacNvLoyJJiNfcvg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="./js/index.js"></script>
<script src="./js/page.js"></script>
</body>
</html>
